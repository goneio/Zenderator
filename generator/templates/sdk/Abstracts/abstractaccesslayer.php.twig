<?php
namespace Segura\SDK\{{ app_name }}\Abstracts;

use GuzzleHttp\Client as GuzzleClient;
use Psr\Http\Message\ResponseInterface;
use Segura\SDK\{{ app_name }}\Client as SDKClient;

abstract class AbstractAccessLayer
{
    /** @var GuzzleClient */
    protected $guzzleClient;

    /** @var SDKClient **/
    protected $sdkClient;

    private $baseUrl = "http://scmapi.segurasystems.dev";

    /**
     * AbstractAccessLayer constructor.
     * @param GuzzleClient $guzzleClient
     * @parma SDKClient $sdkClient
     */
    public function __construct(
        GuzzleClient $guzzleClient,
        SDKClient $sdkClient
    ){
        $this->guzzleClient = $guzzleClient;
        $this->sdkClient = $sdkClient;
    }

    /**
    * @param string $method
    * @param string $endpoint
    * @param array  $options
    *
    * @return mixed|ResponseInterface
    */
    protected function request(
        $method = "GET",
        $endpoint = "/",
        $options = []
    ) {
        $endpoint = ltrim($endpoint, "/");
        $url = "{$this->baseUrl}/{$endpoint}";
        return $this->guzzleClient->request(
            $method,
            $url,
            array_merge(
                [
                    'headers' => [
                        'User-Agent' => 'lib{{ app_name }}/dev-master',
                        'Accept'     => 'application/json',
                        'Content-Type' => 'application/json',
                    ]
                ],
                $options
            )
        );
    }

    protected function replaceUrlElements(string $endpoint, array $replacements = null){
        if (count($replacements) > 0) {
            foreach($replacements as $key => $value){
                $endpoint = str_replace('{' . $key . '}', $value, $endpoint);
            }
        }
        return $endpoint;
    }
}
