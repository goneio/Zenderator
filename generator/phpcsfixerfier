#!/usr/bin/php
<?php
if(!defined("APP_ROOT")){
    define("ZENDERATOR_ROOT", __DIR__ . "/zenderator");
}else{
    if(!defined("ZENDERATOR_ROOT")) {
        define("ZENDERATOR_ROOT", APP_ROOT);
    }
}
$begin = microtime(true);
echo "php-cs-fixer-fying... \n";
$pathsToPSR2 = [
    ZENDERATOR_ROOT . "/src/Models/Base",
    ZENDERATOR_ROOT . "/src/Models",
    ZENDERATOR_ROOT . "/src/Controllers/Base",
    ZENDERATOR_ROOT . "/src/Controllers",
    ZENDERATOR_ROOT . "/src/Services/Base",
    ZENDERATOR_ROOT . "/src/Services",
    ZENDERATOR_ROOT . "/src/*.php",
    ZENDERATOR_ROOT . "/tests/Api/Generated",
    ZENDERATOR_ROOT . "/tests/Models/Generated",
    ZENDERATOR_ROOT . "/public/index.php",g
    ZENDERATOR_ROOT . "/vendor/segura/zenderator",
];

$phpCsFixerRules = [
    'no_unused_imports',
    'align_double_arrow',
    'align_equals',
    'ordered_use',
    'short_array_syntax',
    'phpdoc_order',
    'phpdoc_params',
    'phpdoc_scalar',
    'phpdoc_separation',
    'phpdoc_short_description'
];

function phpcsfixerfy($pathToPSR2, $phpCsFixerRules)
{
    ob_start();
    echo " > {$pathToPSR2} ... ";
    $begin = microtime(true);
    exec(ZENDERATOR_ROOT . "/vendor/bin/php-cs-fixer fix {$pathToPSR2} --rules=" . implode(",", $phpCsFixerRules));
    $time = microtime(true) - $begin;
    echo " [Complete in " . number_format($time, 2) . "]\n";
    echo ob_get_clean();
}

foreach ($pathsToPSR2 as $pathToPSR2) {
    if (file_exists($pathToPSR2)) {
        phpcsfixerfy($pathToPSR2, $phpCsFixerRules);
    }
}

$time = microtime(true) - $begin;
echo "[ALL DONE]";
echo " [Complete in " . number_format($time, 2) . "]\n";
